// import React, { useState, useEffect } from "react";
// import { useNavigate } from "react-router-dom";
// import { variables } from "../../variables";
// import { Document, Page, pdfjs } from "react-pdf";
// import pdfWorker from "pdfjs-dist/build/pdf.worker.min.mjs?url";
// import mammoth from "mammoth";
// import Navbar from "../../components/navbar";


// pdfjs.GlobalWorkerOptions.workerSrc = pdfWorker;

// function ProfileManage() {
//   const navigate = useNavigate();
//   const [resumes, setResumes] = useState([]);
//   const [loading, setLoading] = useState(true);
//   const [showModal, setShowModal] = useState(false);
//   const [modalMsg, setModalMsg] = useState("");
//   const [modalType, setModalType] = useState("info");
//   const [showForm, setShowForm] = useState(false);
//   const [editingId, setEditingId] = useState(null);
//   const [form, setForm] = useState({ hsName: "", file: null });
//   const [viewingPdf, setViewingPdf] = useState(null); // üÜï PDF ƒëang ƒë∆∞·ª£c xem
//   const [numPages, setNumPages] = useState(null);
//   const [viewingFile, setViewingFile] = useState(null);
//   const [contentMap, setContentMap] = useState({});

//   useEffect(() => {
//     const tkId = localStorage.getItem("tkId");
//     const role = localStorage.getItem("role");
//     if (!tkId || role !== "UngVien") {
//       setModalMsg("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n ·ª©ng vi√™n ƒë·ªÉ truy c·∫≠p trang n√†y.");
//       setModalType("error");
//       setShowModal(true);
//       setTimeout(() => navigate("/login"), 2000);
//     } else {
//       loadResumes();
//       loadContentMap();
//     }
//   }, [navigate]);

//   const loadContentMap = async () => {
//   try {
//     const res = await fetch(variables.API_URL + "NoiDungHoSo", {
//       method: "GET",
//       headers: { "Content-Type": "application/json" },
//       credentials: "include",
//     });
//     const data = await res.json();
//     if (res.ok) {
//       // T·∫°o map: hosoID ‚Üí ndid
//       const map = {};
//       data.forEach(nd => {
//         map[nd.hosoID] = nd.ndid;
//       });
//       setContentMap(map);
//     }
//   } catch (err) {
//     console.error(err);
//   }
// };

//   const loadResumes = async () => {
//     try {
//       const res = await fetch(variables.API_URL + "HoSo/list", {
//         method: "GET",
//         headers: { "Content-Type": "application/json" },
//         credentials: "include",
//       });

//       const data = await res.json();
//       if (res.ok) {
//         setResumes(data.data || []);
//       } else {
//         console.error("L·ªói t·∫£i h·ªì s∆°:", data.message);
//       }
//     } catch (err) {
//       console.error("L·ªói k·∫øt n·ªëi:", err);
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleView = async (hsid) => {
//     try {
//       const res = await fetch(variables.API_URL + `HoSo/view/${hsid}`, {
//         method: "GET",
//         credentials: "include",
//       });

//       if (res.status === 401) {
//         setModalMsg("Phi√™n ƒëƒÉng nh·∫≠p h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.");
//         setModalType("error");
//         setShowModal(true);
//         return;
//       }

//       if (!res.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i file.");

//       const blob = await res.blob();
//       const fileType = blob.type;

//       if (fileType === "application/pdf") {
//         const url = URL.createObjectURL(blob);
//         setViewingFile({ type: "pdf", url });
//       } else if (
//         fileType ===
//         "application/vnd.openxmlformats-officedocument.wordprocessingml.document" ||
//         fileType === "application/msword"
//       ) {
//         // Chuy·ªÉn DOCX -> HTML ƒë·ªÉ hi·ªÉn th·ªã
//         const arrayBuffer = await blob.arrayBuffer();
//         const result = await mammoth.convertToHtml({ arrayBuffer });
//         const htmlContent = result.value; // HTML text
//         setViewingFile({ type: "docx", content: htmlContent });
//       } else {
//         setModalMsg("ƒê·ªãnh d·∫°ng file kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ ƒë·ªÉ xem tr·ª±c ti·∫øp.");
//         setModalType("error");
//         setShowModal(true);
//       }
//     } catch (err) {
//       console.error(err);
//       setModalMsg("Kh√¥ng th·ªÉ xem h·ªì s∆°. Vui l√≤ng th·ª≠ l·∫°i sau.");
//       setModalType("error");
//       setShowModal(true);
//     }
//   };

//   const handleViewContent = (hsid) => {
//   const ndid = contentMap[hsid];
//   if (!ndid) {
//     setModalMsg("Ch∆∞a c√≥ n·ªôi dung h·ªì s∆° cho h·ªì s∆° n√†y.");
//     setModalType("error");
//     setShowModal(true);
//     return;
//   }
//   navigate(`/noidung/${ndid}`);
// };

//   const handleChange = (e) => {
//     const { name, value, files } = e.target;
//     if (name === "file") {
//       setForm({ ...form, file: files?.[0] || null });
//     } else {
//       setForm({ ...form, [name]: value });
//     }
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     if (!form.hsName.trim()) {
//       setModalMsg("Vui l√≤ng nh·∫≠p t√™n h·ªì s∆°.");
//       setModalType("error");
//       setShowModal(true);
//       return;
//     }

//     if (!editingId && !form.file) {
//       setModalMsg("Vui l√≤ng ch·ªçn file ƒë·ªÉ upload.");
//       setModalType("error");
//       setShowModal(true);
//       return;
//     }

//     const formData = new FormData();
//     formData.append("hsName", form.hsName);
//     if (form.file) formData.append("file", form.file);

//     try {
//       const url = editingId
//         ? variables.API_URL + `HoSo/update/${editingId}`
//         : variables.API_URL + "HoSo/create";
//       const method = editingId ? "PUT" : "POST";

//       const res = await fetch(url, {
//         method,
//         body: formData,
//         credentials: "include",
//       });

//       const data = await res.json();
//       if (res.ok) {
//         setModalMsg(data.message || (editingId ? "C·∫≠p nh·∫≠t th√†nh c√¥ng!" : "T·∫°o th√†nh c√¥ng!"));
//         setModalType("success");
//         setShowModal(true);
//         setForm({ hsName: "", file: null });
//         setShowForm(false);
//         setEditingId(null);
//         setTimeout(() => loadResumes(), 1500);
//       } else {
//         setModalMsg(data.message || "ƒê√£ c√≥ l·ªói x·∫£y ra.");
//         setModalType("error");
//         setShowModal(true);
//       }
//     } catch (err) {
//       console.error("L·ªói:", err);
//       setModalMsg("L·ªói k·∫øt n·ªëi m√°y ch·ªß!");
//       setModalType("error");
//       setShowModal(true);
//     }
//   };

//   const handleEdit = (resume) => {
//     setEditingId(resume.hsid);
//     setForm({ hsName: resume.hsName, file: null });
//     setShowForm(true);
//   };

//   const handleDelete = async (hsid) => {
//     if (!window.confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªì s∆° n√†y?")) return;

//     try {
//       const res = await fetch(variables.API_URL + `HoSo/delete/${hsid}`, {
//         method: "DELETE",
//         headers: { "Content-Type": "application/json" },
//         credentials: "include",
//       });

//       const data = await res.json();
//       if (res.ok) {
//         setModalMsg("X√≥a h·ªì s∆° th√†nh c√¥ng!");
//         setModalType("success");
//         setShowModal(true);
//         setTimeout(() => loadResumes(), 1500);
//       } else {
//         setModalMsg(data.message || "ƒê√£ c√≥ l·ªói x·∫£y ra.");
//         setModalType("error");
//         setShowModal(true);
//       }
//     } catch (err) {
//       console.error("L·ªói:", err);
//       setModalMsg("L·ªói k·∫øt n·ªëi m√°y ch·ªß!");
//       setModalType("error");
//       setShowModal(true);
//     }
//   };

//   const handleCancel = () => {
//     setShowForm(false);
//     setEditingId(null);
//     setForm({ hsName: "", file: null });
//   };

//   const handleCreateNew = () => {
//     navigate("/add-profile");
//   };

//   if (loading) return <p className="text-center mt-6">ƒêang t·∫£i d·ªØ li·ªáu...</p>;

//   return (
//     <>
//     <Navbar/>
//     <div className="max-w-5xl mx-auto p-6">
//       <h1 className="text-3xl font-bold mb-6">Qu·∫£n l√Ω H·ªì s∆°</h1>

//       {/* === Xem PDF tr·ª±c ti·∫øp === */}
//       {viewingPdf && (
//         <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
//           <div className="bg-white p-4 rounded-lg w-[90%] h-[90%] overflow-auto">
//             <button
//               onClick={() => setViewingPdf(null)}
//               className="mb-3 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition"
//             >
//               ƒê√≥ng
//             </button>

//             {viewingPdf.type === "pdf" ? (
//               <Document
//                 file={viewingPdf.url}
//                 onLoadSuccess={({ numPages }) => setNumPages(numPages)}
//                 loading={<p>ƒêang t·∫£i PDF...</p>}
//               >
//                 {Array.from(new Array(numPages), (el, index) => (
//                   <Page key={index} pageNumber={index + 1} width={800} />
//                 ))}
//               </Document>
//             ) : (
//               <iframe
//                 src={`https://docs.google.com/gview?url=${encodeURIComponent(
//                   viewingPdf.url
//                 )}&embedded=true`}
//                 title="Word Viewer"
//                 width="100%"
//                 height="100%"
//                 className="border-0"
//               />
//             )}
//           </div>
//         </div>
//       )}


//       {viewingFile && (
//         <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
//           <div className="bg-white p-4 rounded-lg w-[90%] h-[90%] overflow-auto">
//             <button
//               onClick={() => setViewingFile(null)}
//               className="mb-3 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition"
//             >
//               ƒê√≥ng
//             </button>

//             {viewingFile.type === "pdf" ? (
//               <Document
//                 file={viewingFile.url}
//                 onLoadSuccess={({ numPages }) => setNumPages(numPages)}
//                 loading={<p>ƒêang t·∫£i PDF...</p>}
//               >
//                 {Array.from(new Array(numPages), (el, index) => (
//                   <Page key={index} pageNumber={index + 1} width={800} />
//                 ))}
//               </Document>
//             ) : (
//               <div
//                 className="prose max-w-none"
//                 dangerouslySetInnerHTML={{ __html: viewingFile.content }}
//               />
//             )}
//           </div>
//         </div>
//       )}


//       {/* === Danh s√°ch h·ªì s∆° === */}
//       {!showForm ? (
//         <>
//           {/* <button
//             onClick={() => setShowForm(true)}
//             className="mb-6 bg-primary text-white px-6 py-2 rounded hover:bg-primary/90 transition"
//           >
//             + T·∫°o H·ªì s∆° M·ªõi
//           </button> */}
//           <button onClick={() => navigate("/add-profile")} className="mb-6 bg-primary text-white px-6 py-2 rounded hover:bg-primary/90 transition">
//             + T·∫°o H·ªì s∆° M·ªõi
//           </button>

//           {resumes.length === 0 ? (
//             <div className="bg-gray-100 p-8 rounded text-center">
//               <p className="text-gray-600 mb-4">B·∫°n ch∆∞a c√≥ h·ªì s∆° n√†o.</p>
//               <button
//                 onClick={() => setShowForm(true)}
//                 className="bg-primary text-white px-4 py-2 rounded hover:bg-primary/90 transition"
//               >
//                 T·∫°o h·ªì s∆° ƒë·∫ßu ti√™n
//               </button>
//             </div>
//           ) : (
//             <div className="grid gap-4">
//               {resumes.map((resume) => (
//                 <div
//                   key={resume.hsid}
//                   className="bg-white border border-gray-200 rounded-lg p-4 shadow hover:shadow-md transition"
//                 >
//                   <div className="flex justify-between items-start">
//                     {/* ‚úÖ T√™n h·ªì s∆° */}
//                     <div className="flex-1">
//                       <h3 className="text-lg font-semibold text-primary mb-2">
//                         {resume.hsName}
//                       </h3>

//                       {/* ‚úÖ T√™n file: click ƒë·ªÉ xem n·ªôi dung file */}
//                       <p className="text-sm text-gray-600 mb-2">
//                         File:{" "}
//                         <span
//                           onClick={() => handleView(resume.hsid)}
//                           className="font-mono text-xs text-blue-600 cursor-pointer hover:underline"
//                         >
//                           {resume.viTriFile?.split("\\").pop() || "N/A"}
//                         </span>
//                       </p>

//                       {/* ‚úÖ N√∫t Xem n·ªôi dung h·ªì s∆° */}
//                       <button
//                         onClick={() => handleViewContent(resume.hsid)}
//                         className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition text-sm"
//                       >
//                         Xem n·ªôi dung h·ªì s∆°
//                       </button>
//                     </div>

//                     {/* ‚úÖ N√∫t s·ª≠a / x√≥a gi·ªØ nguy√™n */}
//                     <div className="flex gap-2">
//                       <button
//                         onClick={() => handleEdit(resume)}
//                         className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition text-sm"
//                       >
//                         S·ª≠a
//                       </button>
//                       <button
//                         onClick={() => handleDelete(resume.hsid)}
//                         className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition text-sm"
//                       >
//                         X√≥a
//                       </button>
//                     </div>
//                   </div>
//                 </div>
//               ))}
//             </div>
//           )}
//         </>
//       ) : (
//         // === Form th√™m/s·ª≠a h·ªì s∆° ===
//         <div className="bg-white border border-gray-200 rounded-lg p-6 shadow">
//           <h2 className="text-2xl font-bold mb-4">{editingId ? "S·ª≠a H·ªì s∆°" : "T·∫°o H·ªì s∆° M·ªõi"}</h2>
//           <form onSubmit={handleSubmit} className="space-y-4">
//             <div>
//               <label className="block font-medium mb-2">T√™n H·ªì s∆°</label>
//               <input
//                 type="text"
//                 name="hsName"
//                 value={form.hsName}
//                 onChange={handleChange}
//                 className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-primary"
//                 required
//               />
//             </div>

//             <div>
//               <label className="block font-medium mb-2">
//                 {editingId ? "C·∫≠p nh·∫≠t File (T√πy ch·ªçn)" : "Ch·ªçn File"}
//               </label>
//               <input
//                 type="file"
//                 name="file"
//                 onChange={handleChange}
//                 accept=".pdf,.doc,.docx"
//                 className="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-primary"
//                 required={!editingId}
//               />
//               <p className="text-xs text-gray-500 mt-1">
//                 Ch·∫•p nh·∫≠n: .pdf, .doc, .docx
//               </p>
//             </div>

//             <div className="flex gap-3 pt-4">
//               <button
//                 type="submit"
//                 className="flex-1 bg-primary text-white py-2 rounded hover:bg-primary/90 transition font-medium"
//               >
//                 {editingId ? "C·∫≠p nh·∫≠t" : "T·∫°o"}
//               </button>
//               <button
//                 type="button"
//                 onClick={handleCancel}
//                 className="flex-1 bg-gray-300 text-gray-800 py-2 rounded hover:bg-gray-400 transition font-medium"
//               >
//                 H·ªßy
//               </button>
//             </div>
//           </form>
//         </div>
//       )}

//       {/* === Modal th√¥ng b√°o === */}
//       {showModal && (
//         <div className="fixed inset-0 flex items-center justify-center bg-black/40 z-50">
//           <div className="bg-white p-6 rounded shadow-lg max-w-sm">
//             <p
//               className={`text-lg mb-4 ${modalType === "error"
//                 ? "text-red-600"
//                 : modalType === "success"
//                   ? "text-green-600"
//                   : "text-gray-700"
//                 }`}
//             >
//               {modalMsg}
//             </p>
//             <button
//               onClick={() => setShowModal(false)}
//               className="w-full bg-primary text-white px-4 py-2 rounded hover:bg-primary/90 transition"
//             >
//               ƒê√≥ng
//             </button>
//           </div>
//         </div>
//       )}
//     </div>
//     </>
//   );
// }

// export default ProfileManage;